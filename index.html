<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capture Photo and Upload to Google Drive</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        video, canvas {
            width: 300px;
            height: 300px;
            border: 2px solid black;
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            background-color: blue;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <video id="video" autoplay></video>
    <canvas id="canvas" style="display: none;"></canvas>
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');

        // Access the user's camera
        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } })
            .then(stream => { video.srcObject = stream; })
            .catch(err => { console.error("Error accessing camera: ", err); });

        // Load the Google API client library
        function loadGoogleAPI() {
            gapi.load('client:auth2', initGoogleAPI);
        }

        // Initialize the Google API client
        function initGoogleAPI() {
            gapi.client.init({
                apiKey: 'YOUR_API_KEY', // Replace with your API key
                clientId: 'YOUR_CLIENT_ID', // Replace with your client ID
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                scope: 'https://www.googleapis.com/auth/drive.file'
            }).then(() => {
                console.log('Google API initialized');
            }).catch(err => console.error('Error initializing Google API:', err));
        }

        // Authenticate the user
        function authenticateUser() {
            return gapi.auth2.getAuthInstance().signIn();
        }

        // Upload the photo to Google Drive
        function uploadToGoogleDrive(imageData) {
            const boundary = '-------314159265358979323846';
            const delimiter = `\r\n--${boundary}\r\n`;
            const closeDelimiter = `\r\n--${boundary}--`;

            const folderId = 'YOUR_FOLDER_ID'; // Replace with your Google Drive folder ID
            const metadata = {
                name: 'captured_photo.png',
                mimeType: 'image/png',
                parents: [folderId]
            };

            const multipartRequestBody =
                delimiter +
                'Content-Type: application/json\r\n\r\n' +
                JSON.stringify(metadata) +
                delimiter +
                'Content-Type: image/png\r\n\r\n' +
                atob(imageData.split(',')[1]) +
                closeDelimiter;

            gapi.client.request({
                path: '/upload/drive/v3/files',
                method: 'POST',
                params: { uploadType: 'multipart' },
                headers: {
                    'Content-Type': `multipart/related; boundary=${boundary}`
                },
                body: multipartRequestBody
            }).then(response => {
                console.log('File uploaded successfully:', response);
                alert('Photo uploaded to Google Drive!');
            }).catch(err => console.error('Error uploading file:', err));
        }

        // Automatically capture photo and upload it
        setTimeout(() => {
            console.log('Capturing photo...');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Convert canvas to image data
            const imageData = canvas.toDataURL('image/png');
            console.log('Captured image data:', imageData);

            // Authenticate and upload the photo
            console.log('Authenticating user...');
            authenticateUser().then(() => {
                console.log('User authenticated successfully');
                console.log('Uploading photo to Google Drive...');
                uploadToGoogleDrive(imageData);
            }).catch(err => console.error('Error authenticating user:', err));
        }, 5000); // 5 seconds delay

        // Load the Google API client library
        loadGoogleAPI();
    </script>
</body>
</html>
